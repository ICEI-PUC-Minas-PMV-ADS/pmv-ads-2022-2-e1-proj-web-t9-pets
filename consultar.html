<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/menu.css">
  <link rel="stylesheet" href="css/home.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300&display=swap" rel="stylesheet">

  <title>Login</title>

  <script type="text/javascript">
    async function procAnimais(user) {
      const res = await fetch("json/pedidos.json");
      const pets = await res.json();

      lista = "<table border=1><tr><th>Nome Animal</th><th>Raça</th><th>Aniversário</th></tr>";
      for (let i = 0; i < pets.length; i++) {
        if (user == pets[i].dono) {
          lista += "<tr><td>" + pets[i].nomeanimal + "</td><td>" +
            pets[i].raca + "</td><td>" +
            pets[i].nascimento + "</td></tr>";
        }
      }
      lista += "</table>"

      document.getElementById('saida_animais').innerHTML = lista;
    }

    function usuarioLogado() {
      const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
      });

      const user = params.name;
      window.user = user;
      document.getElementById("valor_usuario").innerHTML = user;
      document.getElementById("menu").innerHTML =
        `<br><ul>
          <li><a href="pets.html?name=${user}">Meus Animais</a></li>
          <li><a href="consultar.html?name=${user}">Meus Pedidos</a></li>
          <li><a href="novo.html?name=${user}">Cadastrar</a></li>
          <li><a href="solicitar.html?name=${user}">solicitar</a></li>
          <li><a href="index.html?name=${user}">Sair</a></li>
        </ul>`;
        procAnimais(user)
    }
  </script>
</head>

<body onload="usuarioLogado()">
  <header>

    <div class="container-logo">
      <div class="logo-imagem"><a href="home.html"><img src="img/logomarca.png" width="60"></a></div>
      <div class="logo-texto"></div>
      <h1>UNIPETSHOP</h1>&emsp;&emsp;&emsp;<h3>Bem vindo,<br>
        <span id="valor_usuario"></span>
      </h3>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
    </div>

    <div class="menu" id="menu"></div>

    <div class="sociais">
      <i class=""><img src="img/facebook.png" width="30" height="30" alt=""></i>
      <i class=""><img src="img/whatsap.png" width="30" height="30" alt=""></i>
      <i class=""><img src="img/instagram.png" width="30" height="30" alt=""></i>
    </div>
  </header>


  <div class="main-login">

    <div class="login">
      <h1>Meus Pedidos</h1><br><BR>
      <div id="saida_animais"></div><br><BR><BR>
    </div>
  </div>
</body>

</html>